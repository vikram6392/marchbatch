pipeline {
    agent any

environment {
    AZURE_SUBSCIPTION_ID = credentials('AZURE_SUBSCIPTION_ID')
    AZURE_CLIENT_ID = credentials(' AZURE_CLIENT_ID')
    AZURE_CLIENT_SECRET = credentials('AZURE_CLIENT_SECRET')
    AZURE_TENET_ID = credentials('AZURE_TENET_ID')
}

stages{
    stage('Checkout Code') {
        steps {
            git 'https://github.com/your-repo/terraform-azure.git'
        }
    }

    stage('Azure Login') {
        steps {
            sh '''
            az login --service-principal -u $AZURE_CLIENT_ID -p $ AZURE_CLIENT_SECRET --tenant $AZURE_TENET_ID
            az account set --subscription $AZURE_SUBSCIPTION_ID
            '''
        }
    }

    stage('Terraform init') {
        steps {
            sh 'terrform init'
        }
    }

    stage('Terraform plan') {
        steps {
            sh 'terrform plan -out=tfplan'
        }
    }

    stage('Terraform Apply') {
        steps {
            sh 'terrform apply -auto-arppove tfplan'
        }
    }
    }

post {
    always {
        sh 'terraform state list'
    }
    success{
        echo 'Terraform applied successfully'
    }
    failure {
        echo 'Terraform deplyment failed'
    }
}
}
